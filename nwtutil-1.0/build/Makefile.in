prefix = @prefix@
exec_prefix = ${prefix}
bindir  = ${exec_prefix}/bin
sbindir = ${exec_prefix}/sbin
etcdir  = ${prefix}/etc
mandir  = ${prefix}/share/man

DESTDIR=
UTIL_DIR=utility

TARGET=nwtutil

CC=gcc
CXX=g++
INSTALL=install
LIBS=@LIBPCAP@ @LIBPTHREAD@
CXXFLAGS=@CXXFLAGS@
CXXFLAGS += -I$(UTIL_DIR)
LDFLAGS=$(LIBS)
LDFLAGS += -lrt
OBJS=nwt_config.o\
nwt_nic.o\
nwt_common.o\
nwt_socket.o\
rawsocket.o\
unixsocket.o\
tcpserver.o\
tcpclient.o\
udpserver.o\
udpclient.o\
epollsvr.o\
threadpool.o\
main_aux.o\
main.o

UTIL_OBJ=$(UTIL_DIR)/tutility.o\
$(UTIL_DIR)/parseconf.o\
$(UTIL_DIR)/logger.o\
$(UTIL_DIR)/logqueue.o

all:$(TARGET)
$(TARGET):$(OBJS) $(UTIL_OBJ)
	@echo
	$(CXX) -o $@ $(OBJS) $(UTIL_OBJ) $(LDFLAGS)

%.o:%.cpp
	$(CXX) -c $(CXXFLAGS) $^ -o $@

$(UTIL_OBJ):
	@$(MAKE) -C $(UTIL_DIR)

install:
	$(INSTALL) -d $(DESTDIR)$(bindir) $(DESTDIR)$(sbindir) $(DESTDIR)$(etcdir)
	$(INSTALL) -c -m 755 nwtutil $(DESTDIR)$(bindir)

uninstall:
	@rm -f $(DESTDIR)$(bindir)/nwtutil
clean:
	@$(MAKE) -C $(UTIL_DIR) clean
	@rm -f *.o nwtutil *~
